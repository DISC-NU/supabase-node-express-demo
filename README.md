# Supabase Auth Server

An Express.js server implementing Supabase authentication with PostgreSQL database integration.

## Features

- ğŸ” User authentication with Supabase
- ğŸ“š PostgreSQL database integration
- ğŸ›¡ï¸ Protected routes with middleware
- ğŸ”„ Automatic user profile creation
- ğŸ” Detailed error logging

## Prerequisites

- Node.js (v14 or higher)
- npm or yarn
- PostgreSQL database
- Supabase account and project

## Installation

1. Clone the repository:

```bash
git clone https://github.com/DISC-NU/supabase-node-express-demo.git
cd supabase-auth-server
```

2. Install dependencies:

```bash
npm install
```

3. Create a `.env` file in the root directory:

```env
PORT=3000
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

## Development

To start the development server:

```bash
npm run dev
```

The server will start on `http://localhost:3000`.

## Project Structure

```
src/
â”œâ”€â”€ config/           # Configuration files
â”‚   â””â”€â”€ supabase.js   # Supabase client configuration
â”œâ”€â”€ controllers/      # Route controllers
â”‚   â”œâ”€â”€ authController.js   # Authentication controller
â”‚   â””â”€â”€ userController.js   # User management controller
â”œâ”€â”€ middleware/       # Express middleware
â”‚   â””â”€â”€ auth.js       # Authentication middleware
â”œâ”€â”€ routes/          # API routes
â”‚   â”œâ”€â”€ authRoutes.js # Authentication routes
â”‚   â””â”€â”€ userRoutes.js # User management routes
â”œâ”€â”€ app.js           # Express app setup
â””â”€â”€ server.js        # Server entry point
```

## API Endpoints

### Authentication

- `POST /auth/signup` - Register a new user
- `POST /auth/signin` - Sign in a user
- `GET /auth/protected` - Protected route example

### User Management

- `GET /api/users` - Get all users (protected)
- `GET /api/users/:id` - Get user by ID (protected)

## Database Setup

The server uses PostgreSQL with Supabase. Required tables:

```sql
CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  firstName TEXT NOT NULL,
  lastName TEXT NOT NULL,
  email TEXT NOT NULL UNIQUE,
  bio TEXT,
  major TEXT NOT NULL,
  graduationYear INTEGER NOT NULL,
  profilePicture TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  auth_id UUID REFERENCES auth.users(id)
);

-- Add necessary indexes
CREATE INDEX users_email_idx ON users(email);
```

## Environment Variables

- `PORT`: Server port (default: 3000)
- `SUPABASE_URL`: Your Supabase project URL
- `SUPABASE_ANON_KEY`: Your Supabase project's anonymous key

## Available Scripts

- `npm run start` - Start production server
- `npm run dev` - Start development server with nodemon

## Error Handling

The server includes comprehensive error handling:

- Authentication errors
- Database errors
- Validation errors
- Custom error middleware

## Security Features

- JWT token validation
- Protected routes
- SQL injection prevention
- Request validation
- Error sanitization

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## Testing

```bash
# Example API test using curl
curl -X POST http://localhost:3000/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "password123"}'
```

## License

This project is licensed under the MIT License - see the LICENSE file for details
